    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <title>Registro de estacionamiento para reserva</title>
      <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>


      <style>
      
      @import url("https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css");

  .alert-warning {
      color: #a33529;
    }

      input[type="checkbox"], input[type="radio"]{
        position: absolute;
        right: 9000px;
      }

      /*Check box*/
      input[type="checkbox"] + .label-text:before{
        content: "\f096";
        font-family: "FontAwesome";
        speak: none;
        font-style: normal;
        font-variant: normal;
        text-transform: none;
        line-height: 1;
        -webkit-font-smoothing:antialiased;
        width: 1em;
        display: inline-block;
        margin-right: 5px;
      }

      input[type="checkbox"]:checked + .label-text:before{
        content: "\f14a";
        color: #2980b9;
        animation: effect 250ms ease-in;
      }


      @keyframes effect{
        0%{transform: scale(0);}
        25%{transform: scale(1.3);}
        75%{transform: scale(1.4);}
        100%{transform: scale(1);}
      }
    </style>

    </head>
    <body>
      <nav class="navbar navbar-inverse">
        <div class="container">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-4">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">Reserva de estacionamiento</a>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="navbar-collapse-4">
            <ul class="nav navbar-nav navbar-right">
              
              <!--<li><a href="#">Ofrecer un lugar</a></li>-->
              <li><a href="buscarestacionamiento.html">¿Buscar estacionamiento?</a></li>
              <li><a href="estacionamiento_horario.html">Ofrecer un lugar</a></li>
              <li>
                  <a class="btn btn-default btn-outline btn-circle collapsed"  data-toggle="collapse" href="#nav-collapse4" aria-expanded="false" aria-controls="nav-collapse4">user01<i class=""></i> </a>
                </li>
            </ul>
            <ul class="collapse nav navbar-nav nav-collapse slide-down" role="search" id="nav-collapse4">
              <!--<li><a href="#">Support</a></li>-->
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><img class="img-circle" src="https://cdn2.iconfinder.com/data/icons/system-icons/512/489749-Gear-512.png" alt="maridlcrmn" width="20" />Configuración<span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  <li><a href="#">Mi perfil</a></li>
                  <li><a href="registrarauto.html">Registrar auto</a></li>
                  <li><a href="#">Buscar estacionamiento</a></li>
                  <li><a href="#">Ofrecer un lugar</a></li>
                  <li class="divider"></li>
                  <li><a href="#">Cerrar sesión</a></li>
                </ul>
              </li>
            </ul>
          </div><!-- /.navbar-collapse -->
        </div><!-- /.container -->
      </nav><!-- /.navbar -->
      <div class="container"> 
          <div>
             <legend class="text-center header"><h2>Registro de estacionamiento y horarios</h2></legend>  
          </div>      
      <form class="form-horizontal" action="index2.html">
      <div style="float: left;width: 42%;">
        <div class="row col-sm-10">
       
          <!--<h2><strong>Iniciar sesión </strong> <br/></h2><br/>-->
          <!--<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">-->
            <div class="col-sm-6"></div>
            <div class="col-sm-11"> 
                                            
              <!-- Start form -->
             <input type="hidden" name="idEstacionamiento" id="idEstacionamiento">

             
 
              <div class="form-group">
                <label for="exampleInputEmail1">Nombre Estacionamiento</label>
                <input type="text" class="form-control" placeholder="Estacionamiento tu cochera" name="nombre" id="nombre" required>
              </div>

                <div class="form-group">
                  <label for="exampleInputEmail1">Tipo Estacionamiento</label>
                  <select class="form-control " id="txt_idTipoEstacionamiento" name="txt_idTipoEstacionamiento"  id="txt_idTipoEstacionamiento">
                    <option value="1">Pequeño</option>
                    <option value="2">Mediano</option>
                    <option value="3">Grande </option>
                    <option value="4">moto</option>
                    <option value="5">Auto</option>
                    <option value="6">Van</option>
                    <option value="7">Custer</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="sel2">Tipo Propiedad</label>
                  <select class="form-control" id="txt_idTipopropiedad" name="txt_idTipopropiedad"  id=="txt_idTipopropiedad">
                    <option value="1">Casa Privada</option>
                    <option value="2">Edificio habitacional</option>
                    <option value="3">Hotel</option>
                    <option value="4">Terreno</option>
                    <option value="5">Institución</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="sel2">Dirección</label>
                  <input type="text" name="direccion" class="form-control" id="direccion" aria-describedby="emailHelp" placeholder="Ejemplo: Av Arquipa 4560, Miraflores , peru" required>

                </div>
     

             
              <div class="form-group">
                <i class="fa fa-map">&nbsp;</i><label for="exampleInputEmail1">Latitud</label>
                <input type="text" class="form-control" placeholder="Ejemplo: -12.047918"  name="latitud" id="latitud" readonly="readonly">
              </div>


              <div class="form-group">
                <i class="fa fa-map">&nbsp;</i><label for="exampleInputEmail1">Longitud</label>
                <input type="text" class="form-control"   placeholder="Ejemplo: -77.041305" name="longitud" id="longitud" readonly="readonly">
              </div>

            



            <!-- End form -->
          </div>


            <!-- End form -->
          </div>

        </div>



    <div style="height: 20px;">

    </div> 


    <div style="float: left;width: 58%;">
     <div class="row col-sm-13">
      <div class="panel panel-primary">
        <div class="panel-body">
          <div class="col-sm-3">
             <label for="inputValue"  control-label">Día de la semana</label>
          <div class = "form-group">
             <input type="date" name="fecha"  min="2018-09-24" class="form-control"  value = "2018-09-26";
                                      max="2019-09-26" step="1"  onChange="diaSemana()" id="fechaSeleccionada">
          </div> 
         </div> 

          <div class="col-sm-2">
             <label for="inputValue" control-label">Hora Ing.</label>
          <div class = "form-group">
               <select class="form-control" id="txtHoraIngreso" name="txtHoraIngreso">
                          <option value="08:00">08:00</option>
                          <option value="09:00">09:00</option>
                          <option value="10:00">10:00</option>
                          <option value="11:00">11:00</option>
                          <option value="12:00">12:00</option>
                          <option value="13:00">13:00</option>
                          <option value="14:00">14:00</option>
                          <option value="15:00">15:00</option>
                          <option value="16:00">16:00</option>
                          <option value="17:00">17:00</option>
                          <option value="18:00">18:00</option>
                          <option value="19:00">19:00</option>
                 </select>       
          </div>
         </div>


      <div class="col-sm-2">
         <label for="inputValue"control-label">Hora sal.</label>
          <div class = "form-group">
              <select class="form-control" id="txtHoraSalida" name="txtHoraSalida">
                          <option value="09:00">09:00</option>
                          <option value="10:00">10:00</option>
                          <option value="11:00">11:00</option>
                          <option value="12:00">12:00</option>
                          <option value="13:00" selected="">13:00</option>
                          <option value="14:00">14:00</option>
                          <option value="15:00">15:00</option>
                          <option value="16:00">16:00</option>
                          <option value="17:00">17:00</option>
                          <option value="18:00">18:00</option>
                          <option value="19:00">19:00</option>
                     </select>   
          </div>
         </div>
         <div class="col-sm-2">
         <div class="form-group">
            
                  <label>Tarifa x día</label>
                  <input type="number" class="form-control"  id="txtTarifa" name="txtTarifa" required>
                
              
              </div>

        </div>

     
         <div class="col-sm-3">
         <div class="form-group">
                <div class="col-sm-4">
                  <button  data-placement= "bottom" class="btn btn-info"  title="Agregar Horarios" type="button" id="btnAgregar"  data-toggle="tooltip1">Agregar</button>
                </div>
              
              </div>

        </div>


    <!-- Tabla -->
     <div class="col-sm-11">
      <table id="detalles" class="table table-striped table-bordered table-condensed table-hover">
          <thead style="background: #A9D0F5">
            
            <th>Día</th>
            <th>Fecha</th>
            <th>Hora Ingreso</th>
            <th>Hora Salida</th>
            <th>Tarifa</th>
            <th>Opción</th>

          </thead>

          <tbody>

          </tbody>

        
      </table>




     </div>
    </div>

      <div>
      

      </div>

     </div> 
        <div class="form-group">
             <input type="hidden" name="_token"  value="{{ csrf_token() }}"></input>
          <button  class="btn btn-primary"  type="button" id="btnRegistrar" >Registrar</button>
         
        </div>


    <!-- ALERT DIA CON HORARIOS YA AGREGADOS-->
    <div  id="myAlert" class="alert alert-warning  collapse" role="alert">
     <a  id="linkClose"  href="#" class="close">&times;</a>
      <strong>Info!</strong> No puedes registrar más horarios en el mismo día!
    </div>


      <!-- ALERT HORARIO RESERVADO NO PUEDE SER MODIFICADO-->
    <div  id="myAlertReservado" class="alert alert-warning  collapse" role="alert">
     <a  id="linkCloseReservado"  href="#" class="close">&times;</a>
      <strong>Info!</strong> El horario ya ha sido reservado no se puede eliminar!
    </div>


      
    </div>
    </div>

    </form>

    <!-- MODAL -->
    <div class="modal fade" id="mostrarmodal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
       <div class="modal-dialog">
          <div class="modal-content">
             <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3>REGISTRO EXITOSO!</h3>
         </div>
             <div class="modal-body">
                <h4>Se realizó el registro del estacionamiento con sus horarios.</h4>
               
         </div>
             <div class="modal-footer">
            <a href="#" data-dismiss="modal" class="btn btn-danger">Cerrar</a>
         </div>
          </div>
       </div>
    </div>

    </div>



      <script  type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA9UBjTLUW92zCisqDzJCH6kejoFyZyXpk&libraries=places"></script>

      <script type="text/javascript">  
      google.maps.event.addDomListener(window, 'load', intilize);
      function intilize(){
        var autocomplete = new google.maps.places.Autocomplete(document.getElementById('direccion'));
        google.maps.event.addListener(autocomplete, 'place_changed', function(){
          var place = autocomplete.getPlace();
          var latitu_longitud = place.geometry.location + "";  
          var lat = latitu_longitud.substring(1, latitu_longitud.indexOf(","));
          var lon = latitu_longitud.substring(latitu_longitud.indexOf(",")+1,latitu_longitud.length-1);
          
          document.getElementById('latitud').value = lat;
          document.getElementById('longitud').value = lon;
        });
        
      }; 


     

      </script>
    <script type="text/javascript">
       

        $('#btnRegistrar').click(function(e){
           e.preventDefault();
            var idEstacionamiento = $('#idEstacionamiento').val();  
            var txt_idTipopropiedad = $('#txt_idTipopropiedad').val();
            var txt_idTipoEstacionamiento = $('#txt_idTipoEstacionamiento').val();
            var nombre = $('#nombre').val();
            var direccion = $('#direccion').val();
            var latitud = $('#latitud').val();
            var longitud = $('#longitud').val();


            if(nombre.length==0 ){
              alert('El nombre es obligatorio'); 
              return false;
              }
              else if(direccion.length==0 ){
              alert('La direccion es obligatorio');
              return false;
              }


   
           
            var dia = arregloElementos(document.getElementsByName("dia[]"));
            var fechaSeleccionada = arregloElementos(document.getElementsByName("fechaCalendario[]"));
            var h_ingreso = arregloElementos(document.getElementsByName("h_ingreso[]"));
            var h_salida = arregloElementos(document.getElementsByName("h_salida[]"));
            var tarifa = arregloElementos(document.getElementsByName("tarifa[]"));
            var id_estacionamiento_horario = arregloElementos(document.getElementsByName("id_estacionamiento_horario[]"));
            var accion = arregloElementos(document.getElementsByName("accion[]"));
            var idUsuario = "20"//alert($.cookie('test')); 
             

 

      if (confirm("Está seguro de Registrar el estacionamiento y sus horarios?")){

 
               
        $.post('http://localhost:8000/api/estacionamiento', {
            "idEstacionamiento" : idEstacionamiento,
            "txt_idTipopropiedad": txt_idTipopropiedad,
            "txt_idTipoEstacionamiento":txt_idTipoEstacionamiento,
            "nombre": nombre,
            "direccion": direccion,
            "latitud": latitud, 
            "longitud":longitud,
            "dia": dia,
            "fechaSeleccionada": fechaSeleccionada,
            "h_ingreso": h_ingreso,
            "h_salida": h_salida,
            "tarifa": tarifa,
            "idUsuario": idUsuario,
            "id_estacionamiento_horario" : id_estacionamiento_horario,
            

        }, function(response){
              console.log(response);
             
                if ( response.status == 'ok' ) {
                  $("#mostrarmodal").modal("show"); 
                   

                }
            }, 'json');

      }
     // window.location.href='estacionamiento_horario.html';
          });
     




         function diaSemana(){
          let dias = ["Lunes", "Martes", "Miercoles", "Jueves", "Viernes", "Sabado","Domingo"];
           var x = document.getElementById("fechaSeleccionada");  
          let date = new Date(x.value);
         return dias[date.getDay()] ;
          
          }

        function arregloElementos(arreglo){
          var arrayEle = [];
          
            for(i=0;i<arreglo.length;i++){
            arrayEle.push(arreglo[i].value);
            }

          return arrayEle;
        
        }

    </script>


        <script type="text/javascript">

             var contador = 0;
          $(document).ready(function(){
            $('#btnRegistrar').hide();
  $('[data-toggle="tooltip1"]').tooltip();
  $('[data-toggle="tooltip2"]').tooltip();
  $('[data-toggle="tooltip3"]').tooltip();
       
      var id="42"; 
    
      

      $.get('http://localhost:8000/api/estacionamiento?id='+id, {}, function(response){
        
         if(response.status == 'ok') {
          if(response.data!=null){
            console.log(response.data);
            $('#idEstacionamiento').val(response.data.id);
            $('#txt_idTipopropiedad').val(response.data.id_tipo_propiedad);
            $('#txt_idTipoEstacionamiento').val(response.data.id_tipo_estacionamiento);
            $('#nombre').val(response.data.nombre);
            $('#direccion').val(response.data.direccion);
            $('#latitud').val(response.data.latitud);
            $('#longitud').val(response.data.longitud);
   
            console.log(response.dataArray);

         
        }

    if(response.dataArray!=null){

    for(var i=0;i<response.dataArray.length;i++)
    {

      if(response.dataArray[i]["reservado"] == 1){
        var tr='<tr style = "background:#d9534f; color: #fff;" class = "selected" id="fila' + contador +'">';
         var opcion='<td><button id="btnReservado" type = "button" class="btn btn-warning" title="Eliminar horario" data-toggle="tooltip2" onclick="mensaje()"; >X</button></td></tr>';
       
      }else{
        var tr='<tr class = "selected" id="fila' + contador +'">';
        var opcion="<td><button  type = 'button' class='btn btn-warning' title='Eliminar horario' data-toggle='tooltip3' onclick='eliminar("+contador+");' >X</button></td></tr>";
     
      }
   
        var td1="<td><input type='hidden' name='dia[]' value="+response.dataArray[i]["dia"]+">"+response.dataArray[i]["dia"]+"</td>";
        var td2="<td><input type='hidden' name='fechaCalendario[]' value="+response.dataArray[i]["fecha_calendario"]+">"+response.dataArray[i]["fecha_calendario"]+"</td>";
        var td3="<td><input type='hidden' name='h_ingreso[]' value="+response.dataArray[i]["hora_ingreso"]+">"+response.dataArray[i]["hora_ingreso"]+"</td>";
        var td4="<td><input type='hidden' name='h_salida[]' value="+response.dataArray[i]["hora_salida"]+">"+response.dataArray[i]["hora_salida"]+"</td>"; 
        var td5="<td><input type='hidden' name='tarifa[]' value="+response.dataArray[i]["tarifa"]+">"+response.dataArray[i]["tarifa"]+"</td>";
        var td6="<td style = 'visibility: hidden; display:none'>"+response.dataArray[i]["reservado"]+"</td>";
        var td7="<td style = 'visibility: hidden; display:none'><input type='hidden' name='accion[]' value='M'>M</td>";
        var td8="<td style = 'visibility: hidden; display:none'><input type='hidden' name='id_estacionamiento_horario[]' value="+response.dataArray[i]["id"]+"></td>";
       
         
        contador++; 

   
      
       $("#detalles").append(tr+td1+td2+td3+td4+td5+td6+td7+td8+opcion); 

       
     
    }

      $('#btnRegistrar').text('Modificar');
      $('#btnRegistrar').show();

    }
         }else{
          alert('vacio');
         }
       }, 'json');


            $('#btnAgregar').click(function(e){
                agregar(e);
            });

          }); 


        function mensaje(){
             $("#myAlertReservado").show('fade'); 
             setTimeout(function(){ 
                $("#myAlertReservado").hide('fade');
             },4000);
          }
           
      



            function limpiar(){
             // var x = document.getElementById("txtDia").selectedIndex = 'Lunes';         
           // $('#txtDia option:selected').text('Lunes');

            $('#txtHoraIngreso').val('08:00');
            $('#txtHoraSalida').val('09:00');
            $('#txtTarifa').val('');

            }

          function agregar(e){


             $("#linkClose").click(function(){
              $("#myAlert").hide('fade'); 

             }); 


          
          
          var fechaCalendario = $('#fechaSeleccionada').val();
          var dia = diaSemana();
          var h_ingreso =  $('#txtHoraIngreso').val();
          var h_salida =  $('#txtHoraSalida').val();
          var tarifa =  $('#txtTarifa').val();

          var fechaIngresada = arregloElementos(document.getElementsByName("fechaCalendario[]"));

          for (var i = 0; i<fechaIngresada.length; i++) {
            console.log('fecha : ' + fechaIngresada[i]);

            if(fechaIngresada[i] == fechaCalendario) {
             $("#myAlert").show('fade'); 
             setTimeout(function(){ 
                $("#myAlert").hide('fade');
             },4000);
            
              return false;
            }
     
          }


           // var dia =  $('#txtDia option:selected').text();
         
            
            if(tarifa!="" && tarifa>0){
              var fila = '<tr class = "selected" id="fila' + contador +'"><td><input type="hidden" name="dia[]" value="'+dia+'">'+dia+'</td><td><input type="hidden" name="fechaCalendario[]" value="'+fechaCalendario+'">'+fechaCalendario+'</td><td><input type="hidden" name="h_ingreso[]" value="'+h_ingreso+'">'+h_ingreso+'</td><td><input type="hidden" name="h_salida[]" value="'+h_salida+'">'+h_salida+'</td><td><input type="hidden" name="tarifa[]" value="'+tarifa+'">'+tarifa+'</td> <td style = "visibility: hidden; display:none"><input type="hidden" name="reservado" value="-1">-1</td> <td style = "visibility: hidden; display:none"><input type="hidden" name="accion[]" value="N">N</td><td style = "visibility: hidden; display:none"><input type="hidden" name="id_estacionamiento_horario[]" value=""></td><td><button type = "button" class="btn btn-warning" title="Eliminar horario"  onclick="eliminar('+contador+');" >X</button></td></tr>'   



              contador++;  
              $('#detalles').append(fila); 
              limpiar(); 

              var filaTabla=document.getElementById("detalles").rows.length;
              if(filaTabla>1){
                $('#btnRegistrar').show();
              }
          

            }else{
              alert('debe ingresar la tarifa');
              return false; 
            }

          }


          function eliminar(index){
            $('#fila' + index).remove();
          }
     



        </script>